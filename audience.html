<!DOCTYPE html>
<html>
<head>
  <title>Quiz ‚Äì Audience View</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <!-- Firebase -->
  <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>
  <script src="firebase.js"></script>

  <style>
    body {
      background: #0b0b0b;
      color: #fff;
      font-family: Arial, sans-serif;
      padding: 20px;
    }
    h1 { font-size: 42px; }
    h2 { font-size: 32px; margin-top: 10px; }
    .status { font-size: 22px; margin: 10px 0; }
    .boards {
      display: flex;
      gap: 20px;
      margin-top: 30px;
    }
    table {
      width: 100%;
      border-collapse: collapse;
      font-size: 20px;
    }
    th, td {
      border: 1px solid #444;
      padding: 10px;
      text-align: center;
    }
    th {
      background: #222;
    }
  </style>
</head>

<body>

<h1 id="question">Waiting for question‚Ä¶</h1>
<h2 id="roundType"></h2>
<div class="status" id="roundStatus"></div>

<div class="boards">
  <div style="flex:1">
    <h2>üèÜ Teams</h2>
    <table>
      <thead>
        <tr><th>Team</th><th>Score</th></tr>
      </thead>
      <tbody id="teamBoard"></tbody>
    </table>
  </div>

  <div style="flex:1">
    <h2>üèÜ Players</h2>
    <table>
      <thead>
        <tr><th>Name</th><th>Score</th></tr>
      </thead>
      <tbody id="playerBoard"></tbody>
    </table>
  </div>
</div>

<script>
const params = new URLSearchParams(window.location.search);
const room = params.get("room");

if (!room) {
  document.body.innerHTML = "<h1>No room selected</h1>";
}

/* ----- ROUND ----- */
firebase.database()
  .ref("rooms/" + room + "/round")
  .on("value", snap => {
    const r = snap.val();
    if (!r) return;

    document.getElementById("question").innerText = r.question || "";
    document.getElementById("roundType").innerText =
      "Round: " + r.type.toUpperCase();

    document.getElementById("roundStatus").innerText =
      r.status === "open" ? "üü¢ Answering Open" : "üî¥ Answering Closed";
  });

/* ----- TEAM LEADERBOARD ----- */
firebase.database()
  .ref("rooms/" + room + "/teams")
  .on("value", snap => {
    const teams = snap.val() || {};
    const list = Object.keys(teams)
      .map(t => ({ name:t, score:teams[t].score }))
      .sort((a,b) => b.score - a.score);

    const tb = document.getElementById("teamBoard");
    tb.innerHTML = "";
    list.forEach(t => {
      const row = `<tr><td>${t.name}</td><td>${t.score}</td></tr>`;
      tb.innerHTML += row;
    });
  });

/* ----- PLAYER LEADERBOARD ----- */
firebase.database()
  .ref("rooms/" + room + "/players")
  .on("value", snap => {
    const players = snap.val() || {};
    const list = Object.values(players)
      .sort((a,b) => b.score - a.score);

    const pb = document.getElementById("playerBoard");
    pb.innerHTML = "";
    list.forEach(p => {
      const row = `<tr><td>${p.name}</td><td>${p.score}</td></tr>`;
      pb.innerHTML += row;
    });
  });
</script>

</body>
</html>
