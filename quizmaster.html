<!DOCTYPE html>
<html>
<head>
  <title>Quiz Master</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <!-- Firebase SDKs -->
  <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>

  <!-- Firebase Config -->
  <script src="firebase.js"></script>
</head>

<body style="font-family:Arial; padding:20px;">

<h2>Quiz Master Dashboard</h2>

<button onclick="createRoom()">Create Room</button>
<h3 id="roomCode"></h3>

<hr>

<h3>Create Teams</h3>
<input id="teamName" placeholder="Team Name">
<button onclick="addTeam()">Add Team</button>
<ul id="teamList"></ul>

<hr>

<h3>Players Joined</h3>
<table border="1" width="100%">
  <thead>
    <tr>
      <th>Name</th>
      <th>WhatsApp</th>
      <th>Team</th>
      <th>Score</th>
    </tr>
  </thead>
  <tbody id="playerList"></tbody>
</table>
<hr>

<h3>Round Control</h3>

<select id="roundType">
  <option value="mcq">MCQ (A / B / C / D)</option>
  <option value="text">Type the Answer</option>
  <option value="buzz">Buzz</option>
</select>

<br><br>

<input id="questionText" placeholder="Enter Question" style="width:100%;">

<br><br>

<button onclick="startRound()">Open Answering</button>
<button onclick="closeRound()">Close Answering</button>

<p id="roundStatus"></p>

<script>
var currentRoom = null;

/* ---------- CREATE ROOM ---------- */
function createRoom() {
  var code = Math.random().toString(36).substring(2, 6).toUpperCase();
  currentRoom = code;

  document.getElementById("roomCode").innerText =
    "Room Code: " + code;

  firebase.database().ref("rooms/" + code).set({
    status: "waiting",
    createdAt: Date.now(),
    teams: {},
    players: {}
  });

  listenForTeams();
  listenForPlayers();
}

/* ---------- TEAMS ---------- */
function addTeam() {
  var name = document.getElementById("teamName").value.trim();
  if (!name || !currentRoom) return;

  firebase.database()
    .ref("rooms/" + currentRoom + "/teams/" + name)
    .set({ score: 0 });

  document.getElementById("teamName").value = "";
}

function listenForTeams() {
  firebase.database()
    .ref("rooms/" + currentRoom + "/teams")
    .on("value", function(snapshot) {
      var teams = snapshot.val() || {};
      var ul = document.getElementById("teamList");
      ul.innerHTML = "";

      for (var t in teams) {
        var li = document.createElement("li");
        li.innerText = t;
        ul.appendChild(li);
      }
    });
}

/* ---------- PLAYERS ---------- */
function listenForPlayers() {
  firebase.database()
    .ref("rooms/" + currentRoom + "/players")
    .on("value", function(snapshot) {
      var players = snapshot.val() || {};
      var tbody = document.getElementById("playerList");
      tbody.innerHTML = "";

      for (var k in players) {
        var p = players[k];
        var row = document.createElement("tr");

        var td1 = document.createElement("td");
        td1.innerText = p.name;

        var td2 = document.createElement("td");
        td2.innerText = p.whatsapp;

        var td3 = document.createElement("td");
        td3.innerText = p.team;

        var td4 = document.createElement("td");
        td4.innerText = p.score;

        row.appendChild(td1);
        row.appendChild(td2);
        row.appendChild(td3);
        row.appendChild(td4);

        tbody.appendChild(row);
      }
    });
}
  /* ---------- ROUND CONTROL ---------- */
function startRound() {
  if (!currentRoom) return;

  var type = document.getElementById("roundType").value;
  var question = document.getElementById("questionText").value;

  firebase.database()
    .ref("rooms/" + currentRoom + "/round")
    .set({
      type: type,
      question: question,
      status: "open",
      startedAt: Date.now()
    });

  document.getElementById("roundStatus").innerText =
    "Answering OPEN";
}

function closeRound() {
  if (!currentRoom) return;

  firebase.database()
    .ref("rooms/" + currentRoom + "/round/status")
    .set("closed");

  document.getElementById("roundStatus").innerText =
    "Answering CLOSED";
}

</script>

</body>
</html>
