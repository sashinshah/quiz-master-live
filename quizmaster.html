<!DOCTYPE html>
<html>
<head>
  <title>Quiz Master</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <!-- Firebase SDKs -->
  <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>

  <!-- Firebase Config -->
  <script src="firebase.js"></script>
</head>

<body style="font-family:Arial; text-align:center; padding:20px;">

<h2>Quiz Master Dashboard</h2>

<button onclick="createRoom()">Create New Room</button>

<h3 id="roomCode"></h3>
<hr>

<h3>Create Teams</h3>

<input id="teamName" placeholder="Team Name">
<button onclick="addTeam()">Add Team</button>

<ul id="teamList"></ul>
<hr>

<h3>Players Joined</h3>
<table border="1" width="100%" style="border-collapse:collapse;">
  <thead>
    <tr>
      <th>Name</th>
      <th>WhatsApp</th>
      <th>Team</th>
      <th>Score</th>
    </tr>
  </thead>
  <tbody id="playerList"></tbody>
</table>

<script>
let currentRoom = null;

function createRoom() {
  const code = Math.random().toString(36).substring(2, 6).toUpperCase();
  currentRoom = code;

  document.getElementById("roomCode").innerText =
    "Room Code: " + code;

  firebase.database().ref("rooms/" + code).set({
    status: "waiting",
    createdAt: Date.now(),
    teams: {}
  });
    listenForTeams();
    listenForPlayers();
}

function addTeam() {
  alert("Add Team button clicked");

  const name = document.getElementById("teamName").value.trim();
  alert("Team name: " + name);

  if (!currentRoom) {
    alert("Room not created yet");
    return;
  }

  firebase.database()
    .ref("rooms/" + currentRoom + "/teams/" + name)
    .set({ score: 0 })
    .then(() => {
      alert("Team saved to Firebase");
    })
    .catch(err => {
      alert("Firebase error: " + err.message);
    });
}

function listenForTeams() 
function listenForPlayers() {
  firebase.database()
    .ref("rooms/" + currentRoom + "/players")
    .on("value", snapshot => {
      const players = snapshot.val() || {};
      const tbody = document.getElementById("playerList");
      tbody.innerHTML = "";

      Object.values(players).forEach(p => {
        const row = document.createElement("tr");

        row.innerHTML = `
          <td>${p.name}</td>
          <td>${p.whatsapp}</td>
          <td>${p.team}</td>
          <td>${p.score}</td>
        `;

        tbody.appendChild(row);
      });
    });
}

</script>


</body>
</html>
